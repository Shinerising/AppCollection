(()=>{"use strict";class e{}e.URL="app.awayne.me",e.Owner="Shinerising",e.API="https://github-api.awayne.me/api",e.User="https://github-api.awayne.me/users",e.Content="https://github-api.awayne.me/content",e.Download="https://github-api.awayne.me/download";const t=navigator.language.startsWith("zh")?"zh":"en",n={en:{PAGE_TITLE:"Application Collection",BRIEF_NULL:"No brief.",BUTTON_DOCUMENT:"Document",BUTTON_PREVIEW:"Preview",BUTTON_PACKAGE:"Package"},zh:{PAGE_TITLE:"应用软件集合",BRIEF_NULL:"暂无简介。",BUTTON_DOCUMENT:"查看文档",BUTTON_PREVIEW:"预览版本",BUTTON_PACKAGE:"下载"}}[t],i=e=>n[e];var a=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,r)}l((i=i.apply(e,t||[])).next())}))};class o{static timeout(e){return a(this,void 0,void 0,(function*(){return new Promise((t=>{setTimeout((()=>{t(!0)}),e)}))}))}static nextFrame(){return a(this,void 0,void 0,(function*(){return new Promise((e=>{requestAnimationFrame((()=>{e(!0)}))}))}))}}class s{static load(){this.sitename=document.querySelector("#sitename"),this.titleBox=document.querySelector("#title"),this.coverGlass=document.querySelector("#cover>.cover-glass"),this.card=document.querySelector(".card"),this.collection=document.querySelector(".collection")}static query(e){return document.querySelector(e)}static queryAll(e){return document.querySelectorAll(e)}}var r=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,r)}l((i=i.apply(e,t||[])).next())}))};HTMLElement.prototype.addClass=function(e){this.classList.contains(e)||this.classList.add(e)},HTMLElement.prototype.removeClass=function(e){this.classList.contains(e)&&this.classList.remove(e)},HTMLElement.prototype.toggleClass=function(e){this.classList.contains(e)?this.classList.remove(e):this.classList.add(e)},HTMLElement.prototype.val=function(e){return""===e?this.value="":e&&(this.value=e),this.value},(new class{start(){return r(this,void 0,void 0,(function*(){yield this.waitDocumentReady(),s.load(),this.startTypingTitle("Sic Parvis Magna."),this.addScrollHandler(),class{static startFetching(){return a(this,void 0,void 0,(function*(){const t=yield this.fetchData("list.json");s.card.addClass("visible");const n=yield this.fetchData(`${e.User}/${e.Owner}/packages?package_type=container`);t.map((t=>a(this,void 0,void 0,(function*(){const i=document.createElement("section");i.addClass("repo"),s.collection.appendChild(i);try{const a=yield this.fetchData(`${e.API}/${e.Owner}/${t.name}`),o=yield this.fetchData(`${e.API}/${e.Owner}/${t.name}/releases`),s=this.generateNode(t,a,o,n.filter((e=>e.repository.full_name===a.full_name)));yield this.applyNode(i,s)}catch(e){i.remove()}}))))}))}static applyNode(e,t){return a(this,void 0,void 0,(function*(){e.innerHTML+=t,yield o.nextFrame(),e.addClass("visible")}))}static generateNode(n,a,o,s=[]){var r,l;const c=o.filter((e=>!e.prerelease))[0],d=o.filter((e=>e.prerelease))[0],u=s.map((e=>`<a class="link-github icon-github" href="${e.html_url}">${e.name.toUpperCase()}</a>`));return`\n<div class="repo-cover">\n<img src="${e.Content}/${a.full_name}/contents/preview.jpg" alt="${a.description}"/>\n</div>\n<div class="repo-info">\n<div class="repo-header">\n<div class="repo-icon">\n<img src="${e.Content}/${a.full_name}/contents/icon.png" alt="${a.name}">\n</div>\n<h2 class="repo-title"><a href="${a.html_url}">${(null===(r=n.locale[t])||void 0===r?void 0:r.full_name)||n.full_name||a.name}</a></h2>\n</div>\n<div class="repo-labelbox">\n<span>${a.language}</span>${a.topics.map((e=>`<span>${e}</span>`)).join("")}\n</div>\n<p class="repo-description">${null!==(l=a.description)&&void 0!==l?l:i("BRIEF_NULL")}</p>\n<ul class="repo-property">\n<li class="icon-monitor" title="Platform">${n.platform}</li>\n<li class="icon-tag" title="Latest version">${(null==c?void 0:c.tag_name.toUpperCase())||"Preview"}</li>\n<li class="icon-code" title="Code size">${this.getSize(a.size)}</li>\n<li class="icon-clock" title="Updated time">${this.timeDifference((new Date).getTime(),new Date(a.pushed_at).getTime())}</li>\n</ul>\n</div>\n<div class="repo-link">\n<a class="link-github icon-book-open" href="${n.document}">${i("BUTTON_DOCUMENT")}</a>\n<a class="link-github icon-download" href="${(null==d?void 0:d.assets[0])?`${d.assets[0].url.replace("https://api.github.com/repos",e.Download)}?file=${d.assets[0].name}`:""}">${i("BUTTON_PREVIEW")}</a>\n<a class="link-github icon-download" href="${(null==c?void 0:c.assets[0])?`${c.assets[0].url.replace("https://api.github.com/repos",e.Download)}?file=${c.assets[0].name}`:""}">${i("BUTTON_PACKAGE")} ${(null==c?void 0:c.tag_name.toUpperCase())||"Release"}</a>\n${u}\n</div>\n    `}static fetchData(e){return a(this,void 0,void 0,(function*(){return yield fetch(e).then((e=>e.json())).then((e=>e))}))}static getSize(e){return e<1024?e+"KB":Math.round(e/1024)+"MB"}static timeDifference(e,t){const n=new Intl.RelativeTimeFormat(navigator.language||"en"),i=36e5,a=864e5,o=2592e6,s=31536e6,r=e-t;return r<6e4?n.format(-1*Math.round(r/1e3),"second"):r<i?n.format(-1*Math.round(r/6e4),"minute"):r<a?n.format(-1*Math.round(r/i),"hour"):r<o?n.format(-1*Math.round(r/a),"day"):r<s?n.format(-1*Math.round(r/o),"month"):n.format(-1*Math.round(r/s),"year")}}.startFetching();try{yield this.registerServiceWorker()}catch(e){console.error(e)}}))}registerServiceWorker(){return r(this,void 0,void 0,(function*(){"serviceWorker"in navigator&&(yield navigator.serviceWorker.register("service-worker.js"),navigator.serviceWorker.addEventListener("controllerchange",(()=>{window.location.reload()})))}))}startTypingTitle(e){return r(this,void 0,void 0,(function*(){yield o.timeout(500),s.query("#titleBox").style.opacity="1",s.query("#titleBack").textContent=e,yield o.timeout(1e3);for(const t of e.split(""))yield o.timeout(50+Math.round(200*Math.random())),s.titleBox.innerHTML+=" "===t?"&nbsp;":t}))}addScrollHandler(){let e=window.scrollY,t=!1;this.setScrollValue(e),document.addEventListener("scroll",(()=>{e=window.scrollY,t||(window.requestAnimationFrame((()=>{this.setScrollValue(e),t=!1})),t=!0)}))}setScrollValue(e){const t=Math.min(3,Math.min(e/100,20)),n=Math.min(5,Math.min(e/100,20)),i=Math.min(2,Math.min(e/100,10)-2),a=Math.max(0,2-Math.max(e/200,1)),o=`saturate(180%) blur(${n}rem)`;s.coverGlass.setAttribute("style",`-webkit-backdrop-filter:${o};backdrop-filter:${o}`),s.titleBox.setAttribute("style",`filter:blur(${i}rem);opacity:${a}`),s.sitename.setAttribute("style",`filter:blur(${t}rem);opacity:${a}`)}waitDocumentReady(){return new Promise((e=>{if("complete"===document.readyState||"interactive"===document.readyState)e(!0);else{const t=()=>{document.removeEventListener("DOMContentLoaded",t),e(!0)};document.addEventListener("DOMContentLoaded",t)}}))}}).start()})();